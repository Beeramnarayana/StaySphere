services:
  - type: web
    name: staysphere
    env: node
    buildCommand: |
      echo "ğŸš€ Starting build process..."
      echo "ğŸ“¦ Node version: $(node -v)"
      echo "ğŸ“¦ NPM version: $(npm -v)"
      
      # Run the build script
      echo "\nğŸ”„ Running build script..."
      node build.js
      
      # Verify build
      if [ -d "client/build" ]; then
        echo "\nâœ… Build verification:"
        echo "Build directory exists at: $(pwd)/client/build"
        echo "Contents: $(ls -la client/build/)"
      else
        echo "\nâŒ Build verification failed: client/build directory not found"
        exit 1
      fi
      
      echo "\nğŸ‰ Build process completed successfully!"
      
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        fromDatabase:
          name: mongodb
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRE
        value: 30d
      - key: JWT_COOKIE_EXPIRE
        value: '30'
