services:
  - type: web
    name: staysphere
    env: node
    buildCommand: |
      echo "🚀 Starting build process..."
      echo "📦 Node version: $(node -v)"
      echo "📦 NPM version: $(npm -v)"
      
      # Run the build script
      echo "\n🔄 Running build script..."
      node build.js
      
      # Verify build
      if [ -d "client/build" ]; then
        echo "\n✅ Build verification:"
        echo "Build directory exists at: $(pwd)/client/build"
        echo "Contents: $(ls -la client/build/)"
      else
        echo "\n❌ Build verification failed: client/build directory not found"
        exit 1
      fi
      
      echo "\n🎉 Build process completed successfully!"
      
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        fromDatabase:
          name: mongodb
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRE
        value: 30d
      - key: JWT_COOKIE_EXPIRE
        value: '30'
